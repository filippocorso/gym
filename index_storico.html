<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Storico Allenamenti</title>
<link rel="stylesheet" href="app.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="app.js"></script>
<script src="historico.js"></script>
</head>
<body>
<header>
  <h1>Storico Allenamenti</h1>
  <button class="btn" onclick="tornaHome()">⬅ Torna</button>
</header>

<main id="main"></main>

<script>
function tornaHome(){
  window.location.href = "index.html";
}

function mostraStoricoCompleto(){
  const main=document.getElementById("main");
  main.innerHTML="";

  if(storico.length===0){
    main.innerHTML="<p>Nessun allenamento salvato</p>";
    return;
  }

  // Lista allenamenti
  const list = document.createElement("ul");
  list.className="list";
  storico.forEach((a, i)=>{
    const li=document.createElement("li");
    li.innerHTML=`<span style="flex:1;text-align:left;cursor:pointer">${a.data} - ${a.scheda} - ${a.allenamento} - Volume: ${a.volumeTotale}</span>`;
    li.querySelector("span").onclick=()=>mostraAllenamentoStorico(i);
    list.appendChild(li);
  });
  main.appendChild(list);

  // Grafico generale
  const canvas=document.createElement("canvas");
  canvas.id="graficoStorico";
  canvas.style.marginTop="20px";
  main.appendChild(canvas);

  const ctx = document.getElementById("graficoStorico").getContext("2d");
  new Chart(ctx,{
    type:'line',
    data:{
      labels: storico.map(e=>e.data),
      datasets:[{
        label:'Volume Totale',
        data: storico.map(e=>e.volumeTotale),
        borderColor:'#0a84ff',
        fill:false
      }]
    },
    options:{responsive:true}
  });
}

// Mostra allenamento singolo
function mostraAllenamentoStorico(index){
  const a=storico[index];
  const main=document.getElementById("main");
  main.innerHTML=`<h2>${a.scheda} - ${a.allenamento}</h2>
  <p>Data: ${a.data} | Durata: ${a.durata}s | Volume Totale: ${a.volumeTotale}</p>
  <button class="btn" onclick="mostraStoricoCompleto()">⬅ Torna</button>`;

  a.esercizi.forEach(e=>{
    const div=document.createElement("div");
    div.className="nomeEsercizio";
    div.textContent=e.nome;
    main.appendChild(div);

    e.serie.forEach((s,si)=>{
      const serieDiv=document.createElement("div");
      serieDiv.className="serie";
      serieDiv.innerHTML=`Serie ${si+1}: ${s.peso}kg x ${s.reps} reps | Completata: ${s.completata?"✔️":"❌"}`;
      main.appendChild(serieDiv);
    });
  });
}

// Avvio
mostraStoricoCompleto();
</script>
</body>
</html>
